<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Weighbridge.Pages.LoadsPage"
             Title="Saved Loads"
             BackgroundColor="#0E0E0E">

    <ContentPage.Resources>
        <ResourceDictionary>
            <x:Double x:Key="HeaderFontSize">28</x:Double>
            <x:Double x:Key="SubHeaderFontSize">16</x:Double>
            <x:Double x:Key="ItemTitleFontSize">16</x:Double>
            <x:Double x:Key="ItemDetailFontSize">14</x:Double>
            <x:Double x:Key="ItemTimestampFontSize">12</x:Double>
            <x:Double x:Key="ButtonFontSize">12</x:Double>

            <x:Double x:Key="MobileHeaderFontSize">22</x:Double>
            <x:Double x:Key="MobileSubHeaderFontSize">14</x:Double>
            <x:Double x:Key="MobileItemTitleFontSize">14</x:Double>
            <x:Double x:Key="MobileItemDetailFontSize">12</x:Double>
            <x:Double x:Key="MobileItemTimestampFontSize">10</x:Double>
            <x:Double x:Key="MobileButtonFontSize">10</x:Double>

            <x:Double x:Key="ContainerPadding">24</x:Double>
            <x:Double x:Key="ContainerSpacing">24</x:Double>
            <x:Double x:Key="ItemPadding">20</x:Double>
            <x:Double x:Key="ItemSpacing">8</x:Double>

            <x:Double x:Key="MobileContainerPadding">16</x:Double>
            <x:Double x:Key="MobileContainerSpacing">16</x:Double>
            <x:Double x:Key="MobileItemPadding">16</x:Double>
            <x:Double x:Key="MobileItemSpacing">6</x:Double>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid x:Name="MainGrid" Padding="{StaticResource ContainerPadding}" RowSpacing="{StaticResource ContainerSpacing}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackLayout Grid.Row="0" Spacing="8">
            <Label Text="Transaction History" TextColor="White" 
                   FontSize="{StaticResource HeaderFontSize}" FontAttributes="Bold" />
            <Label Text="Review, modify, or reprint saved dockets" TextColor="#CCCCCC" 
                   FontSize="{StaticResource SubHeaderFontSize}" />
        </StackLayout>

        <StackLayout Grid.Row="1" x:Name="FiltersSection" Spacing="12" Margin="0,12,0,0">

            <Grid x:Name="PrimaryFiltersGrid" ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" BackgroundColor="#1A1A1A" StrokeThickness="1" Stroke="#444">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <Picker Title="Status" SelectedItem="{Binding SelectedStatusFilter}" 
                            TextColor="White" TitleColor="#888" BackgroundColor="Transparent" 
                            Margin="8,4" FontSize="12">
                        <Picker.ItemsSource>
                            <x:Array Type="{x:Type x:String}">
                                <x:String>All</x:String>
                                <x:String>Open</x:String>
                                <x:String>Closed</x:String>
                            </x:Array>
                        </Picker.ItemsSource>
                    </Picker>
                </Border>

                <Border Grid.Column="1" BackgroundColor="#1A1A1A" StrokeThickness="1" Stroke="#444">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <DatePicker Date="{Binding DateFromFilter}" Format="dd/MM/yyyy" 
                                TextColor="White" BackgroundColor="Transparent" 
                                Margin="8,4" FontSize="12" />
                </Border>

                <Border Grid.Column="2" BackgroundColor="#1A1A1A" StrokeThickness="1" Stroke="#444">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="8" />
                    </Border.StrokeShape>
                    <DatePicker Date="{Binding DateToFilter}" Format="dd/MM/yyyy" 
                                TextColor="White" BackgroundColor="Transparent" 
                                Margin="8,4" FontSize="12" />
                </Border>
            </Grid>

            <Border BackgroundColor="#1A1A1A" StrokeThickness="1" Stroke="#444">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="8" />
                </Border.StrokeShape>
                <Entry Placeholder="Filter by Vehicle Registration" Text="{Binding VehicleRegFilter}" 
                       TextColor="White" BackgroundColor="Transparent" PlaceholderColor="#888"
                       Margin="8,4" FontSize="12" />
            </Border>

            <Grid x:Name="FilterActionsGrid" ColumnSpacing="12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Text="APPLY FILTERS" BackgroundColor="#00FF7F" 
                        TextColor="#0E0E0E" CornerRadius="8" FontAttributes="Bold" 
                        Clicked="OnApplyFiltersClicked" FontSize="{StaticResource ButtonFontSize}"
                        HeightRequest="44" />
                <Button Grid.Column="1" Text="CLEAR" BackgroundColor="#2A2A2A" 
                        TextColor="White" CornerRadius="8" FontAttributes="Bold" 
                        Clicked="OnClearFiltersClicked" FontSize="{StaticResource ButtonFontSize}"
                        HeightRequest="44" />
            </Grid>
        </StackLayout>

        <RefreshView Grid.Row="2" IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
            <CollectionView x:Name="loadsCollectionView" ItemsSource="{Binding Loads}" 
                           BackgroundColor="Transparent" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="0,4">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="MobilePortrait">
                                        <VisualState.StateTriggers>
                                            <AdaptiveTrigger MinWindowWidth="0" MinWindowHeight="600" />
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter TargetName="ItemContentGrid" Property="Grid.Padding" Value="{StaticResource MobileItemPadding}" />
                                            <Setter TargetName="ItemContentGrid" Property="Grid.RowSpacing" Value="{StaticResource MobileItemSpacing}" />
                                            <Setter TargetName="WeightInfoGrid" Property="Grid.ColumnDefinitions" Value="*" />
                                            <Setter TargetName="WeightInfoGrid" Property="Grid.RowDefinitions" Value="Auto,Auto,Auto" />
                                            <Setter TargetName="WeightInfoGrid" Property="Grid.RowSpacing" Value="8" />
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.ColumnDefinitions" Value="*" />
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.RowDefinitions" Value="Auto,Auto" />
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.RowSpacing" Value="8" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="MobileLandscape">
                                        <VisualState.StateTriggers>
                                            <AdaptiveTrigger MinWindowWidth="600" MinWindowHeight="0" />
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.ColumnDefinitions" Value="*,*" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Tablet">
                                        <VisualState.StateTriggers>
                                            <AdaptiveTrigger MinWindowWidth="768" />
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter TargetName="WeightInfoGrid" Property="Grid.ColumnDefinitions" Value="*,*,*" />
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.ColumnDefinitions" Value="*,*" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Desktop">
                                        <VisualState.StateTriggers>
                                            <AdaptiveTrigger MinWindowWidth="1024" />
                                        </VisualState.StateTriggers>
                                        <VisualState.Setters>
                                            <Setter TargetName="WeightInfoGrid" Property="Grid.ColumnDefinitions" Value="*,*,*" />
                                            <Setter TargetName="TransactionDetailsGrid" Property="Grid.ColumnDefinitions" Value="*,*" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <Border BackgroundColor="#1A1A1A" StrokeThickness="1" Stroke="#333">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12" />
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="Black" Offset="0,2" Radius="8" Opacity="0.2" />
                                </Border.Shadow>

                                <Grid x:Name="ItemContentGrid" Padding="{StaticResource ItemPadding}" 
                                      RowSpacing="{StaticResource ItemSpacing}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <Grid Grid.Row="0" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
                                        <Label Grid.Column="0" Text="{Binding VehicleLicense, StringFormat='Vehicle: {0}'}" 
                                               TextColor="White" FontSize="{StaticResource ItemTitleFontSize}" 
                                               FontAttributes="Bold" VerticalOptions="Center" />
                                        <Label Grid.Column="1" Text="{Binding Timestamp, StringFormat='{0:g}'}" 
                                               TextColor="#CCCCCC" FontSize="{StaticResource ItemTimestampFontSize}"
                                               VerticalOptions="Center" />
                                        <Label Grid.Column="2" Text="{Binding Status}" 
                                               TextColor="#CCCCCC" FontSize="{StaticResource ItemTimestampFontSize}"
                                               VerticalOptions="Center" />
                                    </Grid>

                                    <Grid Grid.Row="1" x:Name="WeightInfoGrid" ColumnSpacing="16" 
                                          Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackLayout Grid.Column="0" Spacing="2">
                                            <Label Text="Entrance" TextColor="#888" 
                                                   FontSize="10" FontAttributes="Bold" />
                                            <Label Text="{Binding EntranceWeight, StringFormat='{0} KG'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}" />
                                        </StackLayout>

                                        <StackLayout Grid.Column="1" Spacing="2">
                                            <Label Text="Exit" TextColor="#888" 
                                                   FontSize="10" FontAttributes="Bold" />
                                            <Label Text="{Binding ExitWeight, StringFormat='{0} KG'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}" />
                                        </StackLayout>

                                        <StackLayout Grid.Column="2" Spacing="2">
                                            <Label Text="Net Weight" TextColor="#888" 
                                                   FontSize="10" FontAttributes="Bold" />
                                            <Label Text="{Binding NetWeight, StringFormat='{0} KG'}" 
                                                   TextColor="#00FF7F" FontSize="{StaticResource ItemDetailFontSize}" 
                                                   FontAttributes="Bold" />
                                        </StackLayout>
                                    </Grid>

                                    <Grid Grid.Row="2" x:Name="TransactionDetailsGrid" ColumnSpacing="16" 
                                          Margin="0,8,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <StackLayout Grid.Column="0" Spacing="4">
                                            <Label Text="{Binding CustomerName, StringFormat='Customer: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}" 
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding ItemName, StringFormat='Material: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}"
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding TransportName, StringFormat='Transport: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}"
                                                   LineBreakMode="TailTruncation" />
                                        </StackLayout>

                                        <StackLayout Grid.Column="1" Spacing="4">
                                            <Label Text="{Binding SourceSiteName, StringFormat='From: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}"
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding DestinationSiteName, StringFormat='To: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}"
                                                   LineBreakMode="TailTruncation" />
                                            <Label Text="{Binding DriverName, StringFormat='Driver: {0}'}" 
                                                   TextColor="#CCCCCC" FontSize="{StaticResource ItemDetailFontSize}"
                                                   LineBreakMode="TailTruncation" />
                                        </StackLayout>
                                    </Grid>

                                    <StackLayout Grid.Row="3" IsVisible="{Binding HasRemarks}" Margin="0,4,0,0">
                                        <Label Text="Remarks:" TextColor="#888" FontSize="10" FontAttributes="Bold" />
                                        <Label Text="{Binding Remarks}" TextColor="#CCCCCC" 
                                               FontSize="{StaticResource ItemDetailFontSize}" 
                                               LineBreakMode="WordWrap" />
                                    </StackLayout>

                                    <Grid Grid.Row="4" x:Name="ActionButtonsGrid" ColumnSpacing="12" 
                                          Margin="0,12,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Button Grid.Column="0" Text="EDIT" BackgroundColor="#FFD700" 
                                                TextColor="#0E0E0E" CornerRadius="8" FontAttributes="Bold" 
                                                CommandParameter="{Binding .}" Clicked="OnEditClicked"
                                                FontSize="{StaticResource ButtonFontSize}" HeightRequest="40" />
                                        <Button Grid.Column="1" Text="REPRINT" BackgroundColor="#00FF7F" 
                                                TextColor="#0E0E0E" CornerRadius="8" FontAttributes="Bold" 
                                                CommandParameter="{Binding .}" Clicked="OnReprintClicked"
                                                FontSize="{StaticResource ButtonFontSize}" HeightRequest="40" />
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>

                <CollectionView.EmptyView>
                    <StackLayout Padding="40" Spacing="16" VerticalOptions="Center">
                        <Label Text="ðŸ“‹" FontSize="48" HorizontalOptions="Center" />
                        <Label Text="No transactions found" TextColor="White" FontSize="18" 
                               FontAttributes="Bold" HorizontalOptions="Center" />
                        <Label Text="Try adjusting your filters or add some transactions" 
                               TextColor="#CCCCCC" FontSize="14" HorizontalOptions="Center" 
                               HorizontalTextAlignment="Center" />
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </RefreshView>
    </Grid>

</ContentPage>